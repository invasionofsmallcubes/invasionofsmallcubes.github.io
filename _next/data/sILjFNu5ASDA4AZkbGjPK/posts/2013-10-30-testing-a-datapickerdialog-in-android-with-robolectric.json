{"pageProps":{"postData":{"id":"2013-10-30-testing-a-datapickerdialog-in-android-with-robolectric","c":"This is not actual a tutorial, rather a report on what I've tried to do test it.\n\nI was following the documentation located on [Android Developers](http://developer.android.com/reference/android/app/DatePickerDialog.html) about create a **DatePickerDialog**.\n\nI started using a DatePicker component in the xml layout of the activity, but the thing was pretty ugly, so I tried this solution instead.\n\nI'll explain first the implementation because it's pretty similar to the example taken from the docs, although I started writing tests first.\n\n~~~ java\nimport java.util.Calendar;\n\nimport android.app.DatePickerDialog;\nimport android.app.Dialog;\nimport android.os.Bundle;\nimport android.support.v4.app.DialogFragment;\nimport android.widget.DatePicker;\n\npublic class DatePickerFragment extends DialogFragment implements\n\t\tDatePickerDialog.OnDateSetListener {\n\n\tfinal Calendar calendar = Calendar.getInstance();\n\n\t@Override\n\tpublic Dialog onCreateDialog(Bundle savedInstanceState) {\n\t   // I create the new DatePickerDialog setting the date to now\n\t   // this is the part I'm having the problem with Robolectric\n\t   // it doesn't seem I'm able to test that the date is setted to NOW\n\t\treturn new DatePickerDialog(getActivity(), this,\n\t\t\t\tcalendar.get(Calendar.YEAR), calendar.get(Calendar.MONTH),\n\t\t\t\tcalendar.get(Calendar.DAY_OF_MONTH));\n\t}\n\n\t@Override\n\tpublic void onDateSet(DatePicker view, int year, int month, int day) {\n\t   /** onDataset **/ implementation\n\t}\n\n}\n~~~\n\nAs you can see the code is pretty straight forward. What I wanted to test is that, given a certain DataPickerDialog, the date showed is the one I set.\nThe date picker is a **DialogFragment** so I want to be able to test it without the usage of a the activity where I want to use the dialog.\nWhen I use the activity it become an integration test, kinda :)\n\nLet's start saying a Dialog is a pain in the ass to test. You still need to build a **FragmentActivity** and then call a **FragmentManager**.\nYou start the transaction, call `show` on the fragment, and then you execute the call. Let's see it:\n\n~~~ java\n@RunWith(RobolectricTestRunner.class)\npublic class DatePickerFragmentTest {\n\n\t@Test\n\tpublic void testDatePickerFragment() {\n\t\tfinal Calendar calendar = Calendar.getInstance();\n\t\tint expectedYear = calendar.get(Calendar.YEAR);\n\t\tint expectedMonth = calendar.get(Calendar.MONTH);\n\t\tint expectedDay = calendar.get(Calendar.DAY_OF_MONTH);\n\n\t\tDatePickerFragment fragment = new DatePickerFragment();\n\n\t\tFragmentActivity activity = Robolectric\n\t\t\t\t.buildActivity(FragmentActivity.class).create().start()\n\t\t\t\t.resume().get();\n\n\t\tFragmentManager fragmentManager = activity.getSupportFragmentManager();\n\t\tFragmentTransaction fragmentTransaction = fragmentManager\n\t\t\t\t.beginTransaction();\n\t\tfragment.show(fragmentManager, \"datePicker\");\n\t\tfragmentTransaction.commit();\n\t\tfragmentManager.executePendingTransactions();\n\n\t\tDatePickerDialog dialog = (DatePickerDialog) ShadowDatePickerDialog\n\t\t\t\t.getLatestDialog();\n\n\t\tassertThat(dialog, is(not(nullValue())));\n\n\t\tassertThat(dialog.getDatePicker().getDayOfMonth(), is(expectedDay));\n\t\tassertThat(dialog.getDatePicker().getMonth(), is(expectedMonth));\n\t\tassertThat(dialog.getDatePicker().getYear(), is(expectedYear));\n\t}\n\n}\n~~~\n\nThis is where I'm blocked. It seems I'm able to assert that the dialog is not null, but when it comes to execute the `getDataPicker`, I have a big fat `NullPointerException`.\nAsking the question on [stackoverflow](http://stackoverflow.com/questions/19661651/is-there-a-way-to-test-pickers-with-robolectric?noredirect=1#comment29221761_19661651) right now didn't give me a viable solution.\n\nNext step would be to try a real fragment activity with a layout. If even then I go no where, I'll test it with Robotium. Stay tuned.\n","title":"Testing a DataPickerDialog in Android with Robolectric","date":"2013-10-30"}},"__N_SSG":true}