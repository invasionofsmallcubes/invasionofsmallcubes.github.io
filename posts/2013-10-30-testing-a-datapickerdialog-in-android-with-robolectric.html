<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><meta name="description" content="this is my note taking app, shared with everybody"/><meta property="og:image" content="https://og-image.now.sh/Welcome%20to%20the%20Invasion%20Of%20Small%20Cubes.png?theme=dark&amp;md=0&amp;fontSize=75px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fnextjs-black-logo.svg"/><meta name="og:title" content="Welcome to the Invasion Of Small Cubes"/><meta name="twitter:card" content="summary_large_image"/><title>Testing a DataPickerDialog in Android with Robolectric</title><meta name="next-head-count" content="8"/><link rel="preload" href="/_next/static/css/62b896be71e756bbd967.css" as="style"/><link rel="stylesheet" href="/_next/static/css/62b896be71e756bbd967.css"/><link rel="preload" href="/_next/static/css/58699b1a35406fdf6fc5.css" as="style"/><link rel="stylesheet" href="/_next/static/css/58699b1a35406fdf6fc5.css"/><link rel="preload" href="/_next/static/chunks/main-7fafde1b574390a64140.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-ccf5ab034a524403276a.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.5e03480598ad1120f007.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.dee2ffe8ab5f8852fbb0.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-9eb1d08eafee22c07a77.js" as="script"/><link rel="preload" href="/_next/static/chunks/7989c093b81d86ddb0abfb342d5bc2e84730435d.c75a5aa2699ec6de0bb7.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bid%5D-9ee6474579e6a630e263.js" as="script"/></head><body><div id="__next"><div class="layout_container__2t4v2"><header class="layout_header__2rhWq"><a href="/"><img src="/images/face.jpeg" class="layout_headerImage__2h5On utils_borderCircle__13qdJ" alt="The Invasion of Small Cubes"/></a><h2 class="utils_headingLg__de7p0"><a class="utils_colorInherit__3Gudf" href="/">The Invasion of Small Cubes</a></h2></header><main><article><h1 class="utils_headingXl__1XecN">Testing a DataPickerDialog in Android with Robolectric</h1><div class="utils_lightText__12Ckm"><time dateTime="2013-10-30">October 30, 2013</time></div><div><p>This is not actual a tutorial, rather a report on what I&#x27;ve tried to do test it.</p><p>I was following the documentation located on <a href="http://developer.android.com/reference/android/app/DatePickerDialog.html">Android Developers</a> about create a <strong>DatePickerDialog</strong>.</p><p>I started using a DatePicker component in the xml layout of the activity, but the thing was pretty ugly, so I tried this solution instead.</p><p>I&#x27;ll explain first the implementation because it&#x27;s pretty similar to the example taken from the docs, although I started writing tests first.</p><pre style="font-family:Consolas, Menlo, Monaco, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, &quot;Courier New&quot;, Courier, monospace;font-size:14px;line-height:1.375;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;background:#2a2734;color:#9a86fd;padding:1em;margin:.5em 0;overflow:auto"><code style="font-family:Consolas, Menlo, Monaco, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, &quot;Courier New&quot;, Courier, monospace;font-size:14px;line-height:1.375;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;background:#2a2734;color:#9a86fd"><span class="token" style="color:#ffcc99">import</span><span> </span><span class="token" style="-opacity:.7">java</span><span class="token token" style="-opacity:.7;color:#6c6783">.</span><span class="token" style="-opacity:.7">util</span><span class="token" style="color:#6c6783">.</span><span class="token class-name">Calendar</span><span class="token" style="color:#6c6783">;</span><span>
</span>
<span></span><span class="token" style="color:#ffcc99">import</span><span> </span><span class="token" style="-opacity:.7">android</span><span class="token token" style="-opacity:.7;color:#6c6783">.</span><span class="token" style="-opacity:.7">app</span><span class="token" style="color:#6c6783">.</span><span class="token class-name">DatePickerDialog</span><span class="token" style="color:#6c6783">;</span><span>
</span><span></span><span class="token" style="color:#ffcc99">import</span><span> </span><span class="token" style="-opacity:.7">android</span><span class="token token" style="-opacity:.7;color:#6c6783">.</span><span class="token" style="-opacity:.7">app</span><span class="token" style="color:#6c6783">.</span><span class="token class-name">Dialog</span><span class="token" style="color:#6c6783">;</span><span>
</span><span></span><span class="token" style="color:#ffcc99">import</span><span> </span><span class="token" style="-opacity:.7">android</span><span class="token token" style="-opacity:.7;color:#6c6783">.</span><span class="token" style="-opacity:.7">os</span><span class="token" style="color:#6c6783">.</span><span class="token class-name">Bundle</span><span class="token" style="color:#6c6783">;</span><span>
</span><span></span><span class="token" style="color:#ffcc99">import</span><span> </span><span class="token" style="-opacity:.7">android</span><span class="token token" style="-opacity:.7;color:#6c6783">.</span><span class="token" style="-opacity:.7">support</span><span class="token token" style="-opacity:.7;color:#6c6783">.</span><span class="token" style="-opacity:.7">v4</span><span class="token token" style="-opacity:.7;color:#6c6783">.</span><span class="token" style="-opacity:.7">app</span><span class="token" style="color:#6c6783">.</span><span class="token class-name">DialogFragment</span><span class="token" style="color:#6c6783">;</span><span>
</span><span></span><span class="token" style="color:#ffcc99">import</span><span> </span><span class="token" style="-opacity:.7">android</span><span class="token token" style="-opacity:.7;color:#6c6783">.</span><span class="token" style="-opacity:.7">widget</span><span class="token" style="color:#6c6783">.</span><span class="token class-name">DatePicker</span><span class="token" style="color:#6c6783">;</span><span>
</span>
<span></span><span class="token" style="color:#ffcc99">public</span><span> </span><span class="token" style="color:#ffcc99">class</span><span> </span><span class="token class-name">DatePickerFragment</span><span> </span><span class="token" style="color:#ffcc99">extends</span><span> </span><span class="token class-name">DialogFragment</span><span> </span><span class="token" style="color:#ffcc99">implements</span><span>
</span><span>		</span><span class="token class-name">DatePickerDialog</span><span class="token" style="color:#6c6783">.</span><span class="token class-name">OnDateSetListener</span><span> </span><span class="token" style="color:#6c6783">{</span><span>
</span>
<span>	</span><span class="token" style="color:#ffcc99">final</span><span> </span><span class="token class-name">Calendar</span><span> calendar </span><span class="token" style="color:#e09142">=</span><span> </span><span class="token class-name">Calendar</span><span class="token" style="color:#6c6783">.</span><span class="token" style="color:#9a86fd">getInstance</span><span class="token" style="color:#6c6783">(</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">;</span><span>
</span>
<span>	</span><span class="token annotation" style="color:#6c6783">@Override</span><span>
</span><span>	</span><span class="token" style="color:#ffcc99">public</span><span> </span><span class="token class-name">Dialog</span><span> </span><span class="token" style="color:#9a86fd">onCreateDialog</span><span class="token" style="color:#6c6783">(</span><span class="token class-name">Bundle</span><span> savedInstanceState</span><span class="token" style="color:#6c6783">)</span><span> </span><span class="token" style="color:#6c6783">{</span><span>
</span><span>	   </span><span class="token" style="color:#6c6783">// I create the new DatePickerDialog setting the date to now</span><span>
</span><span>	   </span><span class="token" style="color:#6c6783">// this is the part I&#x27;m having the problem with Robolectric</span><span>
</span><span>	   </span><span class="token" style="color:#6c6783">// it doesn&#x27;t seem I&#x27;m able to test that the date is setted to NOW</span><span>
</span><span>		</span><span class="token" style="color:#ffcc99">return</span><span> </span><span class="token" style="color:#ffcc99">new</span><span> </span><span class="token class-name">DatePickerDialog</span><span class="token" style="color:#6c6783">(</span><span class="token" style="color:#9a86fd">getActivity</span><span class="token" style="color:#6c6783">(</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">,</span><span> </span><span class="token" style="color:#ffcc99">this</span><span class="token" style="color:#6c6783">,</span><span>
</span><span>				calendar</span><span class="token" style="color:#6c6783">.</span><span class="token" style="color:#9a86fd">get</span><span class="token" style="color:#6c6783">(</span><span class="token class-name">Calendar</span><span class="token" style="color:#6c6783">.</span><span>YEAR</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">,</span><span> calendar</span><span class="token" style="color:#6c6783">.</span><span class="token" style="color:#9a86fd">get</span><span class="token" style="color:#6c6783">(</span><span class="token class-name">Calendar</span><span class="token" style="color:#6c6783">.</span><span>MONTH</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">,</span><span>
</span><span>				calendar</span><span class="token" style="color:#6c6783">.</span><span class="token" style="color:#9a86fd">get</span><span class="token" style="color:#6c6783">(</span><span class="token class-name">Calendar</span><span class="token" style="color:#6c6783">.</span><span>DAY_OF_MONTH</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">;</span><span>
</span><span>	</span><span class="token" style="color:#6c6783">}</span><span>
</span>
<span>	</span><span class="token annotation" style="color:#6c6783">@Override</span><span>
</span><span>	</span><span class="token" style="color:#ffcc99">public</span><span> </span><span class="token" style="color:#ffcc99">void</span><span> </span><span class="token" style="color:#9a86fd">onDateSet</span><span class="token" style="color:#6c6783">(</span><span class="token class-name">DatePicker</span><span> view</span><span class="token" style="color:#6c6783">,</span><span> </span><span class="token" style="color:#ffcc99">int</span><span> year</span><span class="token" style="color:#6c6783">,</span><span> </span><span class="token" style="color:#ffcc99">int</span><span> month</span><span class="token" style="color:#6c6783">,</span><span> </span><span class="token" style="color:#ffcc99">int</span><span> day</span><span class="token" style="color:#6c6783">)</span><span> </span><span class="token" style="color:#6c6783">{</span><span>
</span><span>	   </span><span class="token doc-comment" style="color:#6c6783">/** onDataset **/</span><span> implementation
</span><span>	</span><span class="token" style="color:#6c6783">}</span><span>
</span>
<span></span><span class="token" style="color:#6c6783">}</span></code></pre><p>As you can see the code is pretty straight forward. What I wanted to test is that, given a certain DataPickerDialog, the date showed is the one I set.
The date picker is a <strong>DialogFragment</strong> so I want to be able to test it without the usage of a the activity where I want to use the dialog.
When I use the activity it become an integration test, kinda :)</p><p>Let&#x27;s start saying a Dialog is a pain in the ass to test. You still need to build a <strong>FragmentActivity</strong> and then call a <strong>FragmentManager</strong>.
You start the transaction, call <code>show</code> on the fragment, and then you execute the call. Let&#x27;s see it:</p><pre style="font-family:Consolas, Menlo, Monaco, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, &quot;Courier New&quot;, Courier, monospace;font-size:14px;line-height:1.375;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;background:#2a2734;color:#9a86fd;padding:1em;margin:.5em 0;overflow:auto"><code style="font-family:Consolas, Menlo, Monaco, &quot;Andale Mono WT&quot;, &quot;Andale Mono&quot;, &quot;Lucida Console&quot;, &quot;Lucida Sans Typewriter&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Liberation Mono&quot;, &quot;Nimbus Mono L&quot;, &quot;Courier New&quot;, Courier, monospace;font-size:14px;line-height:1.375;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;background:#2a2734;color:#9a86fd"><span class="token annotation" style="color:#6c6783">@RunWith</span><span class="token" style="color:#6c6783">(</span><span class="token class-name">RobolectricTestRunner</span><span class="token" style="color:#6c6783">.</span><span class="token" style="color:#ffcc99">class</span><span class="token" style="color:#6c6783">)</span><span>
</span><span></span><span class="token" style="color:#ffcc99">public</span><span> </span><span class="token" style="color:#ffcc99">class</span><span> </span><span class="token class-name">DatePickerFragmentTest</span><span> </span><span class="token" style="color:#6c6783">{</span><span>
</span>
<span>	</span><span class="token annotation" style="color:#6c6783">@Test</span><span>
</span><span>	</span><span class="token" style="color:#ffcc99">public</span><span> </span><span class="token" style="color:#ffcc99">void</span><span> </span><span class="token" style="color:#9a86fd">testDatePickerFragment</span><span class="token" style="color:#6c6783">(</span><span class="token" style="color:#6c6783">)</span><span> </span><span class="token" style="color:#6c6783">{</span><span>
</span><span>		</span><span class="token" style="color:#ffcc99">final</span><span> </span><span class="token class-name">Calendar</span><span> calendar </span><span class="token" style="color:#e09142">=</span><span> </span><span class="token class-name">Calendar</span><span class="token" style="color:#6c6783">.</span><span class="token" style="color:#9a86fd">getInstance</span><span class="token" style="color:#6c6783">(</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">;</span><span>
</span><span>		</span><span class="token" style="color:#ffcc99">int</span><span> expectedYear </span><span class="token" style="color:#e09142">=</span><span> calendar</span><span class="token" style="color:#6c6783">.</span><span class="token" style="color:#9a86fd">get</span><span class="token" style="color:#6c6783">(</span><span class="token class-name">Calendar</span><span class="token" style="color:#6c6783">.</span><span>YEAR</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">;</span><span>
</span><span>		</span><span class="token" style="color:#ffcc99">int</span><span> expectedMonth </span><span class="token" style="color:#e09142">=</span><span> calendar</span><span class="token" style="color:#6c6783">.</span><span class="token" style="color:#9a86fd">get</span><span class="token" style="color:#6c6783">(</span><span class="token class-name">Calendar</span><span class="token" style="color:#6c6783">.</span><span>MONTH</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">;</span><span>
</span><span>		</span><span class="token" style="color:#ffcc99">int</span><span> expectedDay </span><span class="token" style="color:#e09142">=</span><span> calendar</span><span class="token" style="color:#6c6783">.</span><span class="token" style="color:#9a86fd">get</span><span class="token" style="color:#6c6783">(</span><span class="token class-name">Calendar</span><span class="token" style="color:#6c6783">.</span><span>DAY_OF_MONTH</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">;</span><span>
</span>
<span>		</span><span class="token class-name">DatePickerFragment</span><span> fragment </span><span class="token" style="color:#e09142">=</span><span> </span><span class="token" style="color:#ffcc99">new</span><span> </span><span class="token class-name">DatePickerFragment</span><span class="token" style="color:#6c6783">(</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">;</span><span>
</span>
<span>		</span><span class="token class-name">FragmentActivity</span><span> activity </span><span class="token" style="color:#e09142">=</span><span> </span><span class="token class-name">Robolectric</span><span>
</span><span>				</span><span class="token" style="color:#6c6783">.</span><span class="token" style="color:#9a86fd">buildActivity</span><span class="token" style="color:#6c6783">(</span><span class="token class-name">FragmentActivity</span><span class="token" style="color:#6c6783">.</span><span class="token" style="color:#ffcc99">class</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">.</span><span class="token" style="color:#9a86fd">create</span><span class="token" style="color:#6c6783">(</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">.</span><span class="token" style="color:#9a86fd">start</span><span class="token" style="color:#6c6783">(</span><span class="token" style="color:#6c6783">)</span><span>
</span><span>				</span><span class="token" style="color:#6c6783">.</span><span class="token" style="color:#9a86fd">resume</span><span class="token" style="color:#6c6783">(</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">.</span><span class="token" style="color:#9a86fd">get</span><span class="token" style="color:#6c6783">(</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">;</span><span>
</span>
<span>		</span><span class="token class-name">FragmentManager</span><span> fragmentManager </span><span class="token" style="color:#e09142">=</span><span> activity</span><span class="token" style="color:#6c6783">.</span><span class="token" style="color:#9a86fd">getSupportFragmentManager</span><span class="token" style="color:#6c6783">(</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">;</span><span>
</span><span>		</span><span class="token class-name">FragmentTransaction</span><span> fragmentTransaction </span><span class="token" style="color:#e09142">=</span><span> fragmentManager
</span><span>				</span><span class="token" style="color:#6c6783">.</span><span class="token" style="color:#9a86fd">beginTransaction</span><span class="token" style="color:#6c6783">(</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">;</span><span>
</span><span>		fragment</span><span class="token" style="color:#6c6783">.</span><span class="token" style="color:#9a86fd">show</span><span class="token" style="color:#6c6783">(</span><span>fragmentManager</span><span class="token" style="color:#6c6783">,</span><span> </span><span class="token" style="color:#ffcc99">&quot;datePicker&quot;</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">;</span><span>
</span><span>		fragmentTransaction</span><span class="token" style="color:#6c6783">.</span><span class="token" style="color:#9a86fd">commit</span><span class="token" style="color:#6c6783">(</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">;</span><span>
</span><span>		fragmentManager</span><span class="token" style="color:#6c6783">.</span><span class="token" style="color:#9a86fd">executePendingTransactions</span><span class="token" style="color:#6c6783">(</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">;</span><span>
</span>
<span>		</span><span class="token class-name">DatePickerDialog</span><span> dialog </span><span class="token" style="color:#e09142">=</span><span> </span><span class="token" style="color:#6c6783">(</span><span class="token class-name">DatePickerDialog</span><span class="token" style="color:#6c6783">)</span><span> </span><span class="token class-name">ShadowDatePickerDialog</span><span>
</span><span>				</span><span class="token" style="color:#6c6783">.</span><span class="token" style="color:#9a86fd">getLatestDialog</span><span class="token" style="color:#6c6783">(</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">;</span><span>
</span>
<span>		</span><span class="token" style="color:#9a86fd">assertThat</span><span class="token" style="color:#6c6783">(</span><span>dialog</span><span class="token" style="color:#6c6783">,</span><span> </span><span class="token" style="color:#9a86fd">is</span><span class="token" style="color:#6c6783">(</span><span class="token" style="color:#9a86fd">not</span><span class="token" style="color:#6c6783">(</span><span class="token" style="color:#9a86fd">nullValue</span><span class="token" style="color:#6c6783">(</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">;</span><span>
</span>
<span>		</span><span class="token" style="color:#9a86fd">assertThat</span><span class="token" style="color:#6c6783">(</span><span>dialog</span><span class="token" style="color:#6c6783">.</span><span class="token" style="color:#9a86fd">getDatePicker</span><span class="token" style="color:#6c6783">(</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">.</span><span class="token" style="color:#9a86fd">getDayOfMonth</span><span class="token" style="color:#6c6783">(</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">,</span><span> </span><span class="token" style="color:#9a86fd">is</span><span class="token" style="color:#6c6783">(</span><span>expectedDay</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">;</span><span>
</span><span>		</span><span class="token" style="color:#9a86fd">assertThat</span><span class="token" style="color:#6c6783">(</span><span>dialog</span><span class="token" style="color:#6c6783">.</span><span class="token" style="color:#9a86fd">getDatePicker</span><span class="token" style="color:#6c6783">(</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">.</span><span class="token" style="color:#9a86fd">getMonth</span><span class="token" style="color:#6c6783">(</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">,</span><span> </span><span class="token" style="color:#9a86fd">is</span><span class="token" style="color:#6c6783">(</span><span>expectedMonth</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">;</span><span>
</span><span>		</span><span class="token" style="color:#9a86fd">assertThat</span><span class="token" style="color:#6c6783">(</span><span>dialog</span><span class="token" style="color:#6c6783">.</span><span class="token" style="color:#9a86fd">getDatePicker</span><span class="token" style="color:#6c6783">(</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">.</span><span class="token" style="color:#9a86fd">getYear</span><span class="token" style="color:#6c6783">(</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">,</span><span> </span><span class="token" style="color:#9a86fd">is</span><span class="token" style="color:#6c6783">(</span><span>expectedYear</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">)</span><span class="token" style="color:#6c6783">;</span><span>
</span><span>	</span><span class="token" style="color:#6c6783">}</span><span>
</span>
<span></span><span class="token" style="color:#6c6783">}</span></code></pre><p>This is where I&#x27;m blocked. It seems I&#x27;m able to assert that the dialog is not null, but when it comes to execute the <code>getDataPicker</code>, I have a big fat <code>NullPointerException</code>.
Asking the question on <a href="http://stackoverflow.com/questions/19661651/is-there-a-way-to-test-pickers-with-robolectric?noredirect=1#comment29221761_19661651">stackoverflow</a> right now didn&#x27;t give me a viable solution.</p><p>Next step would be to try a real fragment activity with a layout. If even then I go no where, I&#x27;ll test it with Robotium. Stay tuned.</p> </div></article></main><div class="layout_backToHome__1vZsp"><a href="/">← Back to home</a></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"2013-10-30-testing-a-datapickerdialog-in-android-with-robolectric","c":"This is not actual a tutorial, rather a report on what I've tried to do test it.\n\nI was following the documentation located on [Android Developers](http://developer.android.com/reference/android/app/DatePickerDialog.html) about create a **DatePickerDialog**.\n\nI started using a DatePicker component in the xml layout of the activity, but the thing was pretty ugly, so I tried this solution instead.\n\nI'll explain first the implementation because it's pretty similar to the example taken from the docs, although I started writing tests first.\n\n~~~ java\nimport java.util.Calendar;\n\nimport android.app.DatePickerDialog;\nimport android.app.Dialog;\nimport android.os.Bundle;\nimport android.support.v4.app.DialogFragment;\nimport android.widget.DatePicker;\n\npublic class DatePickerFragment extends DialogFragment implements\n\t\tDatePickerDialog.OnDateSetListener {\n\n\tfinal Calendar calendar = Calendar.getInstance();\n\n\t@Override\n\tpublic Dialog onCreateDialog(Bundle savedInstanceState) {\n\t   // I create the new DatePickerDialog setting the date to now\n\t   // this is the part I'm having the problem with Robolectric\n\t   // it doesn't seem I'm able to test that the date is setted to NOW\n\t\treturn new DatePickerDialog(getActivity(), this,\n\t\t\t\tcalendar.get(Calendar.YEAR), calendar.get(Calendar.MONTH),\n\t\t\t\tcalendar.get(Calendar.DAY_OF_MONTH));\n\t}\n\n\t@Override\n\tpublic void onDateSet(DatePicker view, int year, int month, int day) {\n\t   /** onDataset **/ implementation\n\t}\n\n}\n~~~\n\nAs you can see the code is pretty straight forward. What I wanted to test is that, given a certain DataPickerDialog, the date showed is the one I set.\nThe date picker is a **DialogFragment** so I want to be able to test it without the usage of a the activity where I want to use the dialog.\nWhen I use the activity it become an integration test, kinda :)\n\nLet's start saying a Dialog is a pain in the ass to test. You still need to build a **FragmentActivity** and then call a **FragmentManager**.\nYou start the transaction, call `show` on the fragment, and then you execute the call. Let's see it:\n\n~~~ java\n@RunWith(RobolectricTestRunner.class)\npublic class DatePickerFragmentTest {\n\n\t@Test\n\tpublic void testDatePickerFragment() {\n\t\tfinal Calendar calendar = Calendar.getInstance();\n\t\tint expectedYear = calendar.get(Calendar.YEAR);\n\t\tint expectedMonth = calendar.get(Calendar.MONTH);\n\t\tint expectedDay = calendar.get(Calendar.DAY_OF_MONTH);\n\n\t\tDatePickerFragment fragment = new DatePickerFragment();\n\n\t\tFragmentActivity activity = Robolectric\n\t\t\t\t.buildActivity(FragmentActivity.class).create().start()\n\t\t\t\t.resume().get();\n\n\t\tFragmentManager fragmentManager = activity.getSupportFragmentManager();\n\t\tFragmentTransaction fragmentTransaction = fragmentManager\n\t\t\t\t.beginTransaction();\n\t\tfragment.show(fragmentManager, \"datePicker\");\n\t\tfragmentTransaction.commit();\n\t\tfragmentManager.executePendingTransactions();\n\n\t\tDatePickerDialog dialog = (DatePickerDialog) ShadowDatePickerDialog\n\t\t\t\t.getLatestDialog();\n\n\t\tassertThat(dialog, is(not(nullValue())));\n\n\t\tassertThat(dialog.getDatePicker().getDayOfMonth(), is(expectedDay));\n\t\tassertThat(dialog.getDatePicker().getMonth(), is(expectedMonth));\n\t\tassertThat(dialog.getDatePicker().getYear(), is(expectedYear));\n\t}\n\n}\n~~~\n\nThis is where I'm blocked. It seems I'm able to assert that the dialog is not null, but when it comes to execute the `getDataPicker`, I have a big fat `NullPointerException`.\nAsking the question on [stackoverflow](http://stackoverflow.com/questions/19661651/is-there-a-way-to-test-pickers-with-robolectric?noredirect=1#comment29221761_19661651) right now didn't give me a viable solution.\n\nNext step would be to try a real fragment activity with a layout. If even then I go no where, I'll test it with Robotium. Stay tuned.\n","title":"Testing a DataPickerDialog in Android with Robolectric","date":"2013-10-30"}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"2013-10-30-testing-a-datapickerdialog-in-android-with-robolectric"},"buildId":"so12wbV4FU55bFKGMCf_B","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-9297741ddbbb81bca141.js"></script><script src="/_next/static/chunks/main-7fafde1b574390a64140.js" async=""></script><script src="/_next/static/chunks/webpack-ccf5ab034a524403276a.js" async=""></script><script src="/_next/static/chunks/framework.5e03480598ad1120f007.js" async=""></script><script src="/_next/static/chunks/commons.dee2ffe8ab5f8852fbb0.js" async=""></script><script src="/_next/static/chunks/pages/_app-9eb1d08eafee22c07a77.js" async=""></script><script src="/_next/static/chunks/7989c093b81d86ddb0abfb342d5bc2e84730435d.c75a5aa2699ec6de0bb7.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-9ee6474579e6a630e263.js" async=""></script><script src="/_next/static/so12wbV4FU55bFKGMCf_B/_buildManifest.js" async=""></script><script src="/_next/static/so12wbV4FU55bFKGMCf_B/_ssgManifest.js" async=""></script></body></html>