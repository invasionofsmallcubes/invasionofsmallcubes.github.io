<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Domain Modeling Made Functional - Book Report</title>
  <style>
    @import url(https://fonts.googleapis.com/css?family=Merriweather);
    @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);

    body {
      font-family: "Merriweather";
      font-size: xx-large;
    }

    h1,
    h2,
    h3 {
      font-weight: bolder;
      font-weight: 400;
      margin-bottom: 0;
      font-family: "Yanone Kaffeesatz";
    }

    p {
      padding: 0.5em;
      line-height: 1.5em;
      font-size: xx-large;
    }

    li {
      padding: 0.5em;
      line-height: 1em;
      font-size: xx-large;
    }

    .remark-code,
    .remark-inline-code {
      font-family: "Roboto Mono";
    }

    /* theme class for slide pages */
    .inverse {
      background: hsl(0, 0%, 15%);
      color: hsl(0, 5%, 75%);
    }

    .postverse {
      color: hsl(0, 0%, 15%);
      background: hsl(0, 5%, 75%);
    }

    .inverse h1 {
      text-align: center;
      color: hsl(0, 5%, 95%);
      line-height: 0.8em;
    }

    .postverse h1 {
      text-align: center;
      color: hsl(0, 0%, 15%);
      line-height: 0.8em;
    }

    .inverse h2 {
      color: hsl(0, 5%, 90%);
      line-height: 0.8em;
    }

    .postverse h2 {
      color: hsl(0, 0%, 15%);
      line-height: 0.8em;
    }

    .inverse a {
      color: hsl(330, 75%, 50%);
      text-decoration: none;
    }

    .postverse a {
      color: hsl(330, 75%, 50%);
      text-decoration: none;
    }

    .postverse code {
      color: hsl(0, 0%, 15%);
    }

    .inverse code {
      color: hsl(330, 75%, 100%);
    }

    /* custom styles for inline span notation */
    span.red {
      color: hsl(0, 90%, 50%);
      font-size: 0.7em;
    }

    .center-img {
      display: block;
      margin-left: auto;
      margin-right: auto;
      width: 40%;
    }

    .center-img2 {
      display: block;
      margin-left: auto;
      margin-right: auto;
      width: 85%;
    }

    .center-img3 img {
      display: block;
      margin-left: auto;
      margin-right: auto;
      margin-top: -40px;
      width: 60%;
    }

    .center-img-white {
      background-color: white;
    }

    .footnote {
      position: absolute;
      bottom: 2em;
      font-size: 0.7em;
    }

    .center-text {
      text-align: center;
    }

    .center-text p {
      font-size: 15px;
      padding: 0;
      line-height: 0;
    }

    /* print filling whole paper */
    @media print {
      .remark-slide-scaler {
        left: 5vw !important;
        width: 90vw !important;
        top: 5vh !important;
        height: 90vh !important;
        transform: scale(1) !important;
      }
    }
  </style>
</head>

<body>
  <textarea id="source">
class: inverse
layout: true
---
class: center, middle

# Domain Modeling Made Functional 
## Book Report

.foornote[by [Emanuele Ianni](https://www.theinvasionofsmallcubes.com)]

---
class: middle

# The book in a slide
- the importance of having a <u>shared model</u> between devs, domain experts and stakeholders
- how to create a shared model with the strong type system of a functional programming language
- using domain driven design to describe and implement business events and processes
- implementation of a use case with F#

---
class: middle

# Introduction to DDD (Shared Model 1/4)
- In old/structured companies, this is usually the pattern to get stuff done
<img class="center-img" src="classic_requirements.png" />

---
class: middle

# Introduction to DDD (Shared model 2/4)
- In lean companies, this is usually the pattern to get stuff done
<img class="center-img2" src="lean_requirements.png" />

---
class: middle

# Introduction to DDD (Shared model 3/4)
- What if the domain experts, the development
team, other stakeholders, and (most importantly) the source code itself all
share the same model?

.center-img3[![Lean Requirements](lean_requirements.png)]

---
class: middle

# Introduction to DDD (Shared model 4/4)
- _Faster time to market._ When the developer and the codebase share the
same model as the person who has the problem, the team is more likely
to develop an appropriate solution quickly.
- _More business value._ A solution that is accurately aligned with the problem
means happier customers and less chance of going offtrack.
- _Less waste._ Clearer requirements means less time wasted in misunderstanding
and rework.
- _Easier maintenance and evolution._ When the model expressed by the code
closely matches the domain expert’s own model, making changes to the
code is easier and less error-prone.

---
class: middle

# How do we create a shared model?
- Focus on business events and workflows rather than data structures.
- Partition the problem domain into smaller subdomains.
- Create a model of each subdomain in the solution.
- Develop a common language (known as the “Ubiquitous Language”) that
is shared between everyone involved in the project and is used everywhere
in the code.

---
class: middle

# Capturing domain events
<img class="center-img2" src="event_storming.png" />

---
class: middle

# The workflow*
<img class="center-img2" src="flow.png" />
.footnote[*for now we are not considering the error flow]

---
class: middle

# Split the events in sub-domains (1/2)
<img class="center-img2" src="subdomains1.png" />

---
class: middle

# Split the events in sub-domains (2/2)
<img class="center-img2" src="subdomains2.png" />

---
class: middle

# Bounded context
- the subdomains are called <u>bounded context</u> in DDD
- it's a <u>context</u> because each context represents some specialized knowledge
in the solution
- it's <u>bounded</u> meaning that there is a clear separation of concerns between context and we can use software engineering best practices to keep decoupling and allow independent evolution

---
class: middle

# Context map
.center-img3[![context_maps](context_maps.png)]

---
class: middle

# DDD recap (1/2)

- A <u>Domain</u> is an area of knowledge associated with the problem we are
trying to solve.
- A <u>Domain Model</u> is a set of simplifications that represent those aspects of
a domain that are relevant to a particular problem.
- The <u>Ubiquitous Language</u> is a set of concepts and vocabulary that is
associated with the domain and is shared by both the team members and
the source code.
- A <u>Bounded Context</u> is a subsystem in the solution space with clear
boundaries that distinguish it from other subsystems. A bounded context
often corresponds to a subdomain in the problem space.

---
class: middle

# DDD recap (2/2)

- A <u>Context Map</u> is a high-level diagram showing a collection of bounded
contexts and the relationships between them.
- A <u>Domain Event</u> is a record of something that happened in the system.
It’s always described in the past tense. An event often triggers additional
activity.
- A <u>Command</u> is a request for some process to happen and is triggered by
a person or another event. If the process succeeds, the state of the system
changes and one or more Domain Events are recorded.

---
class: middle

# Understanding the domain

- fight the impulse to do <u>Database-Driven Design</u>.
- fight the impulse to do <u>Class-Driven Design</u>.
- focus on documenting the domain.
- let's see an example.

---
class: middle

# Let's document the Place Order workflow (1/3)

<pre>
  workflow "Place Order" =
    nput: OrderForm
    output:
    OrderPlaced event (put on a pile to send to other teams)
    OR InvalidOrder (put on appropriate pile)

    // step 1
    do ValidateOrder
      If order is invalid then:
      add InvalidOrder to pile
    stop

    // step 2
    do PriceOrder

    // step 3
    do SendAcknowledgmentToCustomer

    // step 4
    return OrderPlaced event (if no errors)
</pre>

---
class: middle

# Let's document the Place Order workflow (2/3)

<pre>
  substep "ValidateOrder" =
    input: 
      UnvalidatedOrder
    output: 
      ValidatedOrder OR ValidationError
    dependencies: 
      CheckProductCodeExists, CheckAddressExists

    validate the customer name
    check that the shipping and billing address exist
    for each line:
      check product code syntax
      check that product code exists in ProductCatalog
    if everything is OK, then:
      return ValidatedOrder
    else:
      return ValidationError
</pre>

---
class: middle

# Let's document the Place Order workflow (3/3)

<pre>
  substep "PriceOrder" =
    input: ValidatedOrder
    output: PricedOrder
    dependencies: GetProductPrice
      for each line:
        get the price for the product
        set the price for the line
        set the amount to bill ( = sum of the line prices)
  
  substep "SendAcknowledgmentToCustomer" =
    input: PricedOrder
    output: None
      create acknowledgment letter and send it
      and the priced order to the customer
</pre>
  
---
class: middle

# Data structures for Place Order workflow (1/2)

<pre>
  data UnvalidatedOrder =
    UnvalidatedCustomerInfo
      AND UnvalidatedShippingAddress
      AND UnvalidatedBillingAddress
      AND list of UnvalidatedOrderLine
   
  data UnvalidatedOrderLine =
    UnvalidatedProductCode
    AND UnvalidatedOrderQuantity

  data ValidatedOrder =
    ValidatedCustomerInfo
    AND ValidatedShippingAddress
    AND ValidatedBillingAddress
    AND list of ValidatedOrderLine
</pre>

---
class: middle

# Data structures for Place Order workflow (2/2)

<pre>
  data ValidatedOrderLine =
    ValidatedProductCode
    AND ValidatedOrderQuantity

  data PricedOrder =
    ValidatedCustomerInfo
    AND ValidatedShippingAddress
    AND ValidatedBillingAddress
    AND list of PricedOrderLine // different from ValidatedOrderLine
    AND AmountToBill // new
  
  data PricedOrderLine =
    ValidatedOrderLine
    AND LinePrice // new
</pre>


---
class: middle

# Architecture of a bounded context (1/3)
 
.center-img3[![Layered Architecture](layer_architecture.png)]
.center-text[
Layered Architecture]

---
class: middle

# Architecture of a bounded context (2/3)
 
.center-img3[![Layered Architecture](onion_architecture.png)]
.center-text[
Onion Architecture]

---
class: middle

# Architecture of a bounded context (3/3)

## with the onion architecture you have some advantages:
- we put the domain code at the center
- everything else is assembled on top of the domain
- all the dependencies must point inward
- keep I/O (side effects) at the edge of the architecture

---
class: middle

# Communication between bounded context

.center-img3[![Context Communication](context_comm.png)]

---
class: middle

# Architecture concepts

- A <u>Domain Object</u> is an object designed for use only within the boundaries
of a context, as opposed to a Data Transfer Object.
- A <u>Data Transfer Object</u>, or DTO, is an object designed to be serialized and
shared between contexts.
- An <u>Anti-Corruption Layer</u>, or ACL, is a component that translates concepts
from one domain to another in order to reduce coupling and allow domains
to evolve independently.
- <u>Persistence Ignorance</u> means that the domain model should be based only
on the concepts in the domain itself and should not contain any awareness
of databases or other persistence mechanisms.

---
class: middle

# What is a function?

.center-img3[![Function](function.png)]
.center-text[
A function]

---
class: middle

# F# Types Cheat Sheet (1/2)

- simple types
<pre>type ProductCode = ProductCode of string</pre>
- record types 
<pre>type Person = {First:string; Last:string}</pre>
- choice types 
<pre>type OrderQuantity =
  | UnitQuantity of int
  | KilogramQuantity of decimal</pre>
  
---
class: middle

# F# Types Cheat Sheet (2/2)

- optional values
<pre>type Option<'a> =
  | Some of 'a
  | None</pre>
- modeling errors 
<pre>type Result<'Success,'Failure> =
    | Ok of 'Success
    | Error of 'Failure</pre>
- modeling no value 
<pre>type SaveCustomer = Customer -> unit</pre>

---
class: center, middle

# So long and thanks for all the fish!

<!-- <img class="center-img" src="galileo.gif" /> 
 - [This](https://agilemanifesto.org/).red.bold[*] is where everything has started
.footnote[.red.bold[*][https://agilemanifesto.org](https://agilemanifesto.org)] 
<img class="center-img2" src="CI-CD-graphic.png" />
<img class="center-img3" src="TDD.jpeg" /> -->

</textarea>

  <div style="display: none;">
    --- class: middle # Features of remark.js slide - Slide as a single HTML
    with script urls on CDN, no extra tools required - Write slide pages as
    (extended) markdown texts in a `textarea` tag - Convert to PDF (with
    browser's print feature) --- # Write with markdownsdfsdfs ## Paragraphsssd
    Paragraph with **strong**, *italic*, `code`, or &lt;strike&gt;inline
    strike tag&lt;/strike&gt;. Links as labeled [github](https://github.com/)
    or direct https://github.com/ . ## Blockquote > blockquote texts with "**>
    quoted texts...**" ## Table |ID|Name|Value|fffsdsd |--|----|-----| | 1|foo
    | 10| | 2|bar | 20| --- # Items of markdown no bullte paragraph 1.
    numbered 1 - bullet 1 - bullet 2 2. numbered 2 1. child 1 2. child 2 3.
    numbered 3 --- # GFM code block ```js // remark.js enables highlight.js
    with GFM code block notation // Setting the highlight.js theme at last
    script tag as: // const slideshow = remark.create({highlightStyle:
    "github",}); import {Buffer} from "buffer"; const b =
    Buffer.from("f0f0f0", "hex"); class Target extends EventTarget {
    constructor() { //... tr } close() {} } function isOk() { return true }
    console.log(`${Boolean("true")}`); // here is line 20
    ------------------------------------------------------ col 80 ``` --- #
    Key bindings and Side note ## Key bindings - Forward: right, down and
    space keys - Backward: left, up keys - Full screen toggle: **F** key -
    Cloned Window: **C** key - original and cloned synchronizes their page
    move - Help: **H** key ## Side note for presentation `???` as side-note
    delimiter - Toggle side note: **P** key For presentation - C: open a
    cloned window to move 2nd screen - F: make the cloned fullscreen - P:
    switch side note view on the original window - down, down, down: goto to
    next pages ??? Note here - you can use same notation includes code blocks
    and optional latex notations --- # Other features Span element with
    .red[red span] (it should be specified at the style tag). KaTeX for math
    representaion: $$F(x) = \int_{-\infty}^{\infty}{f(x)}dx + C$$ Mermaid for
    graph:

    <div class="mermaid">
      graph LR; A --> B; B --> C; C --> A; D --> C;
    </div>

    --- # Convert to PDF ## Set CSS `@media print` - Fit paper with `top`
    `left` `width` `height` of `.remark-slide-scaler` ## To PDF file with
    browser's print - Preview and save as PDF - NOTE: render mermail graph
    once displayed --- # Indentless textarea edit with # emacs web-mode -
    Install with `M-x package-install` then type `web-mode` - add
    customization into `~/.emacs` as: ```lisp (add-to-list 'auto-mode-alist
    '("\\.html\\'" . web-mode)) (add-hook 'web-mode-hook (lambda () (setq
    web-mode-markup-indent-offset 2) (setq web-mode-css-indent-offset 2) (setq
    web-mode-code-indent-offset 2) (setq web-mode-style-padding nil) (setq
    web-mode-script-padding nil) (setq web-mode-indentless-elements (append
    web-mode-indentless-elements '("p" "h1" "h2" "h3" "h4"))) (setq
    web-mode-indentless-attributes (append web-mode-indentless-attributes
    '("onload"))) (custom-set-faces '(web-mode-html-tag-face ((t (:foreground
    "blue")))) '(web-mode-html-tag-bracket-face ((t (:foreground "blue")))))))
    ```
  </div>

  <!-- remark.js -->
  <script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>

  <!-- option: katex -->
  <script src="https://unpkg.com/katex/dist/katex.min.js"></script>
  <script src="https://unpkg.com/katex/dist/contrib/auto-render.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/katex/dist/katex.min.css" />

  <!-- option: mermaid -->
  <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
  <style>
    .inverse div.mermaid {
      background-color: hsl(0, 5%, 75%);
    }
  </style>

  <!-- init slide -->
  <script>
    const slideshow = remark.create(
      {
        ratio: "16:9",
        countIncrementalSlides: false,
        highlightStyle: "github" // highlight.js theme
      },
      () => {
        // KaTeX sessting
        renderMathInElement(document.body, {
          delimiters: [
            { left: "$$", right: "$$", display: true },
            { left: "$", right: "$", display: false }
          ]
        });
      }
    );

    // valid rendering mermaid graphs on chrome
    // note for print: once open page before print
    mermaid.initialize({ startOnLoad: false, cloneCssStyles: false });
    slideshow.on("afterShowSlide", s => {
      for (const d of document.querySelectorAll("div.mermaid")) {
        if (d.offsetWidth > 0) mermaid.init(undefined, d);
      }
    });
  </script>
</body>

</html>